var girder_plugin_item_previews=function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};return t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(2),t(t.s=15)}([function(e,t){e.exports=girder_lib},function(e,t,i){e.exports=i(0)(0)},function(e,t,i){"use strict";i(3)},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var r=i(11),s=n(r),o=i(14),d=i(4),l=n(d);(0,o.wrap)(s.default,"render",function(e){return e.call(this),"folder"===this.parentModel.resourceName&&this._showItems&&(this.itemPreviewView=new l.default({class:"g-item-previews-container",collection:this.itemListView.collection,parentView:this}),this.$el.append(this.itemPreviewView.$el),this.itemPreviewView.setCollection(this.itemListView.collection),this.itemPreviewView.render()),this})},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(12),s=n(r),o=i(10),d=n(o),l=i(8),a=n(l),u=i(13),c=i(9),f=i(6),p=n(f),h=i(5),m=n(h);i(7);var v=a.default.extend({events:{"click a.g-item-preview-link":function(e){var t=this.$(e.currentTarget).data("id");this.parentView.itemListView.trigger("g:itemClicked",this.collection.get(t))}},initialize:function(e){this.debouncedaddMoreItems=s.default.debounce(this.addMoreItems,100),this.onScroll=s.default.debounce(this.onScroll,100),this.initialized=!1,this.addingMoreItems=!1,this.supportedItems=[]},setCollection:function(e){var t=this;this.collection=e,this.listenTo(this.collection,"g:changed",function(){t.supportedItems=t.collection.toJSON().filter(t._isSupportedItem.bind(t)),0!==t.supportedItems.length&&(t.isNotFull()||t.isNearBottom())&&t.debouncedaddMoreItems()})},_MAX_JSON_SIZE:2e6,_MAX_IMAGE_SIZE:2e7,_LOAD_BATCH_SIZE:2,_isSupportedItem:function(e){return this._isImageItem(e.name)||this._isJSONItem(e.name)},_isJSONItem:function(e){return/(json)$/i.test(e)},_isImageItem:function(e){return/(jpg|jpeg|png|gif)$/i.test(e)},setElement:function(e){return this.initialized=!1,a.default.prototype.setElement.apply(this,arguments)},render:function(){var e=this;return this.initialized||(this.initialized=!0,this.renderedIndex=0,this.$el.html((0,p.default)()),this.$(".g-widget-item-previews-container").on("scroll",function(t){return e.onScroll(t)}),this.debouncedaddMoreItems()),this},isNotFull:function(){return this.$(".g-widget-item-previews-wrapper").height()<=this.$(".g-widget-item-previews-container").height()},allItemAdded:function(){return this.renderedIndex>=this.supportedItems.length},addMoreItems:function(){var e=this;this.addingMoreItems=!0;var t=this.supportedItems.slice(this.renderedIndex,this.renderedIndex+this._LOAD_BATCH_SIZE);if(this.renderedIndex=Math.min(this.renderedIndex+this._LOAD_BATCH_SIZE,this.supportedItems.length),t.length){var i=this.$(".g-widget-item-previews-wrapper");(0,c._whenAll)(t.map(function(t){return(0,u.restRequest)({url:"item/"+t._id+"/files",data:{limit:5}}).then(function(t){return(0,c._whenAll)(t.map(function(t){return e.tryGetFileContent(t,t.mimeType)}))})})).done(function(n){t.forEach(function(e,t){var r=n[t].filter(function(e){return e});r.length&&i.append((0,m.default)({item:e,contents:r}))}),!e.allItemAdded()&&e.isNotFull()&&e.addMoreItems()}).always(function(){e.addingMoreItems=!1})}},isNearBottom:function(){var e=this.$(".g-widget-item-previews-container");return e.scrollTop()+e.innerHeight()>=e[0].scrollHeight-200},onScroll:function(e){!this.isNearBottom()||this.addingMoreItems||this.allItemAdded()||this.addMoreItems()},tryGetFileContent:function(e,t){return this._isJSONItem(e.name)?e.size>this._MAX_JSON_SIZE?d.default.Deferred().resolve(null).promise():this.getJsonContent("file/"+e._id+"/download"):this._isImageItem(t)?e.size>this._MAX_IMAGE_SIZE?d.default.Deferred().resolve(null).promise():this.getImageContent("file/"+e._id+"/download"):void 0},getJsonContent:function(e){return(0,u.restRequest)({url:e,method:"GET",error:null}).then(function(e){return{type:"json",value:e}})},getImageContent:function(e){var t=d.default.Deferred(),i=u.apiRoot+"/"+e,n=new Image;return n.onload=function(){t.resolve({type:"image",value:i})},n.src=i,t.promise()}});t.default=v},function(e,t,i){"use strict";function n(e){var t,i="",n=e||{};return function(e,n,s){i=i+'<div class="g-widget-item-preview"><h4><a class="g-item-preview-link"'+r.attr("data-id",s._id,!0,!0)+">"+r.escape(null==(t=s.name)?"":t)+"</a></h4>",function(){var o=n;if("number"==typeof o.length)for(var d=0,l=o.length;d<l;d++){var a=o[d];"image"===a.type?i=i+"<div><img"+r.attr("src",a.value,!0,!0)+"></div>":"json"===a.type&&(i=i+'<textarea class="json"'+r.attr("data-id",s._id,!0,!0)+">"+r.escape(null==(t=e.stringify(a.value,null,"\t"))?"":t)+"</textarea>")}else{var l=0;for(var d in o){l++;var a=o[d];"image"===a.type?i=i+"<div><img"+r.attr("src",a.value,!0,!0)+"></div>":"json"===a.type&&(i=i+'<textarea class="json"'+r.attr("data-id",s._id,!0,!0)+">"+r.escape(null==(t=e.stringify(a.value,null,"\t"))?"":t)+"</textarea>")}}}.call(this),i+="</div>"}.call(this,"JSON"in n?n.JSON:"undefined"!=typeof JSON?JSON:void 0,"contents"in n?n.contents:"undefined"!=typeof contents?contents:void 0,"item"in n?n.item:"undefined"!=typeof item?item:void 0),i}var r=i(1);e.exports=n},function(e,t,i){"use strict";function n(e){var t="";return t+='<div class="g-widget-item-previews-header"><i class="icon-eye"></i> Item Previews</div><div class="g-widget-item-previews-container"><div class="g-widget-item-previews-wrapper"></div></div>'}i(1);e.exports=n},function(e,t){},function(e,t,i){e.exports=i(0)(1)},function(e,t,i){e.exports=i(0)(10)},function(e,t,i){e.exports=i(0)(2)},function(e,t,i){e.exports=i(0)(25)},function(e,t,i){e.exports=i(0)(3)},function(e,t,i){e.exports=i(0)(4)},function(e,t,i){e.exports=i(0)(63)},function(e,t,i){e.exports=i}]);