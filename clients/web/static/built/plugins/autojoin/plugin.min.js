var girder_plugin_autojoin=function(t){function e(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(3),e(e.s=16)}([function(t,e){t.exports=girder_lib},function(t,e,n){t.exports=n(0)(5)},function(t,e,n){t.exports=n(0)(7)},function(t,e,n){"use strict";n(4)},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}var i=n(2),r=o(i),a=n(1),s=o(a),u=n(15),l=n(5),d=o(l);(0,u.exposePluginConfig)("autojoin","plugins/autojoin/config"),r.default.route("plugins/autojoin/config","autojoinConfig",function(){s.default.trigger("g:navigateTo",d.default)})},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(11),r=o(i),a=n(12),s=o(a),u=n(14),l=o(u),d=n(10),c=o(d),g=n(2),f=o(g),p=n(9),v=o(p),h=n(1),m=o(h),b=n(13),j=n(6),x=o(j);n(7);var y=v.default.extend({events:{"click .g-autojoin-remove":function(t){this.$("#g-autojoin-error-message").text("");var e=parseInt((0,r.default)(t.currentTarget).attr("data-index"),10);this.rules.splice(e,1),this.render()},"click #g-autojoin-add":function(t){this.$("#g-autojoin-error-message").text("");var e=(0,r.default)("#g-autojoin-pattern").val(),n=(0,r.default)("#g-autojoin-group").val(),o=(0,r.default)("#g-autojoin-level").val();if(""===e||""===n||""===o)return void this.$("#g-autojoin-error-message").text("All fields are required.");var i={pattern:e,groupId:n,level:parseInt(o,10)};this.rules.push(i),this.render()},"click #g-autojoin-save":function(t){this.$("#g-autojoin-error-message").text(""),this._saveSettings([{key:"autojoin",value:this.rules}])},"click #g-autojoin-cancel":function(t){f.default.navigate("plugins",{trigger:!0})}},initialize:function(){this.rules=[],this.collection=new l.default,this.collection.pageLimit=0,this.collection.on("g:changed",function(){this.render()},this).fetch(),(0,b.restRequest)({method:"GET",url:"system/setting",data:{list:JSON.stringify(["autojoin"])}}).done(s.default.bind(function(t){this.rules=t.autojoin||[],this.render()},this))},render:function(){var t=this.collection.toArray(),e={};t.forEach(function(t){e[t.get("_id")]=t});var n={0:"Member",1:"Moderator",2:"Admin"};return this.$el.html((0,x.default)({rules:this.rules,groups:t,groupsById:e,levelNames:n})),new c.default({pluginName:"Auto Join",el:this.$(".g-config-breadcrumb-container"),parentView:this}).render(),this},_saveSettings:function(t){(0,b.restRequest)({method:"PUT",url:"system/setting",data:{list:JSON.stringify(t)},error:null}).done(s.default.bind(function(){m.default.trigger("g:alert",{icon:"ok",text:"Settings saved.",type:"success",timeout:4e3})},this)).fail(s.default.bind(function(t){this.$("#g-autojoin-error-message").text(t.responseJSON.message)},this))}});e.default=y},function(t,e,n){"use strict";function o(t){var e,n="",o=t||{};return function(t,o,r,a){n+='<div class="g-config-breadcrumb-container"></div><p class="g-autojoin-description">The Auto Join plugin allows you to define rules to automatically assign new\nusers to groups based on their email address domain. Typically, this is used in\nconjunction with <a href="#settings">email verification</a>.\n</p><div class="g-autojoin-container"><table class="table table-hover"><thead><tr><th>If email contains</th><th>Add user to group</th><th>With access level</th><th></th></tr></thead><tbody>',a.length||(n+='<tr><td class="g-autojoin-empty" colspan="4">No rules defined.</td></tr>'),function(){var t=a;if("number"==typeof t.length)for(var s=0,u=t.length;s<u;s++){var l=t[s],d=o[l.groupId],c=r[l.level];n=n+"<tr><td>"+i.escape(null==(e=l.pattern)?"":e)+"</td><td>"+i.escape(null==(e=d?d.get("name"):"(group no longer exists)")?"":e)+"</td><td>"+i.escape(null==(e=c)?"":e)+'</td><td><button class="g-autojoin-remove btn btn-xs btn-danger" title="Remove rule"'+i.attr("data-index",s,!0,!0)+'><i class="icon-cancel"></i></button></td></tr>'}else{var u=0;for(var s in t){u++;var l=t[s],d=o[l.groupId],c=r[l.level];n=n+"<tr><td>"+i.escape(null==(e=l.pattern)?"":e)+"</td><td>"+i.escape(null==(e=d?d.get("name"):"(group no longer exists)")?"":e)+"</td><td>"+i.escape(null==(e=c)?"":e)+'</td><td><button class="g-autojoin-remove btn btn-xs btn-danger" title="Remove rule"'+i.attr("data-index",s,!0,!0)+'><i class="icon-cancel"></i></button></td></tr>'}}}.call(this),n+='</tbody><tfoot><tr><td><input class="form-control input-sm" id="g-autojoin-pattern" placeholder="Enter email pattern"></td><td><select class="form-control input-sm" id="g-autojoin-group"><option value="">(Select group)</option>',function(){var o=t;if("number"==typeof o.length)for(var r=0,a=o.length;r<a;r++){var s=o[r];n=n+"<option"+i.attr("value",s.get("_id"),!0,!0)+">"+i.escape(null==(e=s.get("name"))?"":e)+"</option>"}else{var a=0;for(var r in o){a++;var s=o[r];n=n+"<option"+i.attr("value",s.get("_id"),!0,!0)+">"+i.escape(null==(e=s.get("name"))?"":e)+"</option>"}}}.call(this),n+='</select></td><td><select class="form-control input-sm" id="g-autojoin-level"><option value="">(Select access level)</option><option value="0">Member</option><option value="1">Moderator</option><option value="2">Admin</option></select></td><td><button class="btn btn-xs btn-primary" id="g-autojoin-add" title="Add rule"><i class="icon-plus"></i></button></td></tr></tfoot></table></div><p class="g-validation-failed-message" id="g-autojoin-error-message"></p><div class="g-autojoin-buttons"><button class="btn btn-sm btn-primary" id="g-autojoin-save">Save Changes</button><button class="btn btn-sm btn-default" id="g-autojoin-cancel">Cancel</button></div>'}.call(this,"groups"in o?o.groups:"undefined"!=typeof groups?groups:void 0,"groupsById"in o?o.groupsById:"undefined"!=typeof groupsById?groupsById:void 0,"levelNames"in o?o.levelNames:"undefined"!=typeof levelNames?levelNames:void 0,"rules"in o?o.rules:"undefined"!=typeof rules?rules:void 0),n}var i=n(8);t.exports=o},function(t,e){},function(t,e,n){t.exports=n(0)(0)},function(t,e,n){t.exports=n(0)(1)},function(t,e,n){t.exports=n(0)(135)},function(t,e,n){t.exports=n(0)(2)},function(t,e,n){t.exports=n(0)(3)},function(t,e,n){t.exports=n(0)(4)},function(t,e,n){t.exports=n(0)(60)},function(t,e,n){t.exports=n(0)(63)},function(t,e,n){t.exports=n}]);