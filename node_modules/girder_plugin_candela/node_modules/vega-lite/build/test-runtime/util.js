"use strict";
var __assign = (this && this.__assign) || Object.assign || function(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
        s = arguments[i];
        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
            t[p] = s[p];
    }
    return t;
};
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
// import {assert} from 'chai';
var fs = require("fs");
var mkdirp_1 = require("mkdirp");
var vega_util_1 = require("vega-util");
exports.generate = process.env.VL_GENERATE_TESTS;
exports.output = 'test-runtime/resources';
exports.selectionTypes = ['single', 'multi', 'interval'];
exports.compositeTypes = ['repeat', 'facet'];
exports.resolutions = ['union', 'intersect'];
exports.bound = 'bound';
exports.unbound = 'unbound';
exports.tuples = [
    { a: 0, b: 28, c: 0 }, { a: 0, b: 55, c: 1 }, { a: 0, b: 23, c: 2 },
    { a: 1, b: 43, c: 0 }, { a: 1, b: 91, c: 1 }, { a: 1, b: 54, c: 2 },
    { a: 2, b: 81, c: 0 }, { a: 2, b: 53, c: 1 }, { a: 2, b: 76, c: 2 },
    { a: 3, b: 19, c: 0 }, { a: 3, b: 87, c: 1 }, { a: 3, b: 12, c: 2 },
    { a: 4, b: 52, c: 0 }, { a: 4, b: 48, c: 1 }, { a: 4, b: 35, c: 2 },
    { a: 5, b: 24, c: 0 }, { a: 5, b: 49, c: 1 }, { a: 5, b: 48, c: 2 },
    { a: 6, b: 87, c: 0 }, { a: 6, b: 66, c: 1 }, { a: 6, b: 23, c: 2 },
    { a: 7, b: 17, c: 0 }, { a: 7, b: 27, c: 1 }, { a: 7, b: 39, c: 2 },
    { a: 8, b: 68, c: 0 }, { a: 8, b: 16, c: 1 }, { a: 8, b: 67, c: 2 },
    { a: 9, b: 49, c: 0 }, { a: 9, b: 15, c: 1 }, { a: 9, b: 48, 'c': 2 }
];
var unitNames = {
    repeat: ['child_d', 'child_e', 'child_f'],
    facet: ['child_0', 'child_1', 'child_2']
};
exports.hits = {
    discrete: {
        qq: [8, 19],
        qq_clear: [5, 16],
        bins: [4, 29],
        bins_clear: [18, 7],
        repeat: [5, 10, 17],
        repeat_clear: [13, 14, 2],
        facet: [2, 6, 9],
        facet_clear: [3, 4, 8]
    },
    interval: {
        drag: [[5, 14], [18, 26]],
        drag_clear: [[5], [16]],
        translate: [[6, 16], [24, 8]],
        bins: [[4, 8], [2, 7]],
        bins_clear: [[5], [9]],
        bins_translate: [[5, 7], [1, 8]],
        repeat: [[8, 29], [11, 26], [7, 21]],
        repeat_clear: [[8], [11], [17]],
        facet: [[1, 9], [2, 8], [4, 10]],
        facet_clear: [[3], [5], [7]]
    }
};
function base(iter, sel, opts) {
    if (opts === void 0) { opts = {}; }
    var data = { values: opts.values || exports.tuples };
    var x = __assign({ field: 'a', type: 'quantitative' }, opts.x);
    var y = __assign({ field: 'b', type: 'quantitative' }, opts.y);
    var color = __assign({ field: 'c', type: 'nominal' }, opts.color);
    var size = __assign({ value: 100 }, opts.size);
    var selection = { sel: sel };
    var mark = 'circle';
    return iter % 2 === 0 ? {
        data: data, selection: selection, mark: mark,
        encoding: {
            x: x, y: y, size: size,
            color: {
                condition: __assign({ selection: 'sel' }, color),
                value: 'grey'
            }
        }
    } : {
        data: data,
        layer: [{
                selection: selection, mark: mark,
                encoding: {
                    x: x, y: y, size: size, color: color,
                    opacity: { value: 0.25 }
                }
            }, {
                transform: [{ filter: { selection: 'sel' } }],
                mark: mark,
                encoding: { x: x, y: y, size: size, color: color }
            }]
    };
}
function spec(compose, iter, sel, opts) {
    if (opts === void 0) { opts = {}; }
    var _a = base(iter, sel, opts), data = _a.data, spec = __rest(_a, ["data"]);
    var resolve = opts.resolve;
    switch (compose) {
        case 'unit':
            return __assign({ data: data }, spec);
        case 'facet':
            return {
                data: data,
                facet: { row: { field: 'c', type: 'nominal' } },
                spec: spec,
                resolve: resolve
            };
        case 'repeat':
            return {
                data: data,
                repeat: { row: ['d', 'e', 'f'] },
                spec: spec,
                resolve: resolve
            };
    }
    return null;
}
exports.spec = spec;
function unitNameRegex(specType, idx) {
    var name = unitNames[specType][idx].replace('child_', '');
    return new RegExp("child(.*?)_" + name);
}
exports.unitNameRegex = unitNameRegex;
function parentSelector(compositeType, index) {
    return compositeType === 'facet' ? "cell > g:nth-child(" + (index + 1) + ")" :
        unitNames.repeat[index] + '_group';
}
exports.parentSelector = parentSelector;
function brush(key, idx, parent, targetBrush) {
    var fn = key.match('_clear') ? 'clear' : 'brush';
    return "return " + fn + "(" + exports.hits.interval[key][idx].join(', ') + ", " + vega_util_1.stringValue(parent) + ", " + !!targetBrush + ")";
}
exports.brush = brush;
function pt(key, idx, parent) {
    var fn = key.match('_clear') ? 'clear' : 'pt';
    return "return " + fn + "(" + exports.hits.discrete[key][idx] + ", " + vega_util_1.stringValue(parent) + ")";
}
exports.pt = pt;
function embedFn(browser) {
    return function (spec) {
        browser.execute(function (_) { return window['embed'](_); }, spec);
    };
}
exports.embedFn = embedFn;
function svg(browser, path, filename) {
    var xml = browser.executeAsync(function (done) {
        window['view'].runAfter(function (view) { return view.toSVG().then(function (_) { return done(_); }); });
    });
    if (exports.generate) {
        mkdirp_1.sync(path = exports.output + "/" + path);
        fs.writeFileSync(path + "/" + filename + ".svg", xml.value);
    }
    return xml.value;
}
exports.svg = svg;
function testRenderFn(browser, path) {
    return function (filename) {
        // const render =
        svg(browser, path, filename);
        // const file = fs.readFileSync(`${output}/${path}/${filename}.svg`);
        // assert.equal(render, file);
    };
}
exports.testRenderFn = testRenderFn;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3Rlc3QtcnVudGltZS91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwrQkFBK0I7QUFDL0IsdUJBQXlCO0FBQ3pCLGlDQUFzQztBQUN0Qyx1Q0FBc0M7QUFJekIsUUFBQSxRQUFRLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQztBQUN6QyxRQUFBLE1BQU0sR0FBRyx3QkFBd0IsQ0FBQztBQUdsQyxRQUFBLGNBQWMsR0FBb0IsQ0FBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0FBQ2xFLFFBQUEsY0FBYyxHQUFrQixDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUNwRCxRQUFBLFdBQVcsR0FBMEIsQ0FBQyxPQUFPLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFFNUQsUUFBQSxLQUFLLEdBQUcsT0FBTyxDQUFDO0FBQ2hCLFFBQUEsT0FBTyxHQUFHLFNBQVMsQ0FBQztBQUVwQixRQUFBLE1BQU0sR0FBRztJQUNwQixFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUM7SUFDN0QsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDO0lBQzdELEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQztJQUM3RCxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUM7SUFDN0QsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDO0lBQzdELEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQztJQUM3RCxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUM7SUFDN0QsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDO0lBQzdELEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQztJQUM3RCxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUM7Q0FDaEUsQ0FBQztBQUVGLElBQU0sU0FBUyxHQUFHO0lBQ2hCLE1BQU0sRUFBRSxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUUsU0FB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QUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBQyxDQUFTLElBQUssT0FBQSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQVAsQ0FBTyxDQUFDLEVBQXpDLENBQXlDLENBQUMsQ0FBQztJQUNwRixDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxDQUFDLGdCQUFRLENBQUMsQ0FBQyxDQUFDO1FBQ2IsYUFBTSxDQUFDLElBQUksR0FBTSxjQUFNLFNBQUksSUFBTSxDQUFDLENBQUM7UUFDbkMsRUFBRSxDQUFDLGFBQWEsQ0FBSSxJQUFJLFNBQUksUUFBUSxTQUFNLEVBQUUsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3pELENBQUM7SUFFRCxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQztBQUNuQixDQUFDO0FBWEQsa0JBV0M7QUFFRCxzQkFBNkIsT0FBaUMsRUFBRSxJQUFZO0lBQzFFLE1BQU0sQ0FBQyxVQUFTLFFBQWdCO1FBQzlCLGlCQUFpQjtRQUNmLEdBQUcsQ0FBQyxPQUFPLEVBQUUsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQy9CLHFFQUFxRTtRQUNyRSw4QkFBOEI7SUFDaEMsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQVBELG9DQU9DIiwic291cmNlc0NvbnRlbnQiOlsiLy8gaW1wb3J0IHthc3NlcnR9IGZyb20gJ2NoYWknO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IHtzeW5jIGFzIG1rZGlycH0gZnJvbSAnbWtkaXJwJztcbmltcG9ydCB7c3RyaW5nVmFsdWV9IGZyb20gJ3ZlZ2EtdXRpbCc7XG5pbXBvcnQge1NlbGVjdGlvblJlc29sdXRpb24sIFNlbGVjdGlvblR5cGV9IGZyb20gJy4uL3NyYy9zZWxlY3Rpb24nO1xuaW1wb3J0IHtMYXllclNwZWMsIFRvcExldmVsRXh0ZW5kZWRTcGVjLCBVbml0U3BlY30gZnJvbSAnLi4vc3JjL3NwZWMnO1xuXG5leHBvcnQgY29uc3QgZ2VuZXJhdGUgPSBwcm9jZXNzLmVudi5WTF9HRU5FUkFURV9URVNUUztcbmV4cG9ydCBjb25zdCBvdXRwdXQgPSAndGVzdC1ydW50aW1lL3Jlc291cmNlcyc7XG5cbmV4cG9ydCB0eXBlIENvbXBvc2VUeXBlID0gJ3VuaXQnIHwgJ3JlcGVhdCcgfCAnZmFjZXQnO1xuZXhwb3J0IGNvbnN0IHNlbGVjdGlvblR5cGVzOiBTZWxlY3Rpb25UeXBlW10gPSBbJ3NpbmdsZScsICdtdWx0aScsICdpbnRlcnZhbCddO1xuZXhwb3J0IGNvbnN0IGNvbXBvc2l0ZVR5cGVzOiBDb21wb3NlVHlwZVtdID0gWydyZXBlYXQnLCAnZmFjZXQnXTtcbmV4cG9ydCBjb25zdCByZXNvbHV0aW9uczogU2VsZWN0aW9uUmVzb2x1dGlvbltdID0gWyd1bmlvbicsICdpbnRlcnNlY3QnXTtcblxuZXhwb3J0IGNvbnN0IGJvdW5kID0gJ2JvdW5kJztcbmV4cG9ydCBjb25zdCB1bmJvdW5kID0gJ3VuYm91bmQnO1xuXG5leHBvcnQgY29uc3QgdHVwbGVzID0gW1xuICB7YTogMCwgYjogMjgsIGM6IDB9LCB7YTogMCwgYjogNTUsIGM6IDF9LCB7YTogMCwgYjogMjMsIGM6IDJ9LFxuICB7YTogMSwgYjogNDMsIGM6IDB9LCB7YTogMSwgYjogOTEsIGM6IDF9LCB7YTogMSwgYjogNTQsIGM6IDJ9LFxuICB7YTogMiwgYjogODEsIGM6IDB9LCB7YTogMiwgYjogNTMsIGM6IDF9LCB7YTogMiwgYjogNzYsIGM6IDJ9LFxuICB7YTogMywgYjogMTksIGM6IDB9LCB7YTogMywgYjogODcsIGM6IDF9LCB7YTogMywgYjogMTIsIGM6IDJ9LFxuICB7YTogNCwgYjogNTIsIGM6IDB9LCB7YTogNCwgYjogNDgsIGM6IDF9LCB7YTogNCwgYjogMzUsIGM6IDJ9LFxuICB7YTogNSwgYjogMjQsIGM6IDB9LCB7YTogNSwgYjogNDksIGM6IDF9LCB7YTogNSwgYjogNDgsIGM6IDJ9LFxuICB7YTogNiwgYjogODcsIGM6IDB9LCB7YTogNiwgYjogNjYsIGM6IDF9LCB7YTogNiwgYjogMjMsIGM6IDJ9LFxuICB7YTogNywgYjogMTcsIGM6IDB9LCB7YTogNywgYjogMjcsIGM6IDF9LCB7YTogNywgYjogMzksIGM6IDJ9LFxuICB7YTogOCwgYjogNjgsIGM6IDB9LCB7YTogOCwgYjogMTYsIGM6IDF9LCB7YTogOCwgYjogNjcsIGM6IDJ9LFxuICB7YTogOSwgYjogNDksIGM6IDB9LCB7YTogOSwgYjogMTUsIGM6IDF9LCB7YTogOSwgYjogNDgsICdjJzogMn1cbl07XG5cbmNvbnN0IHVuaXROYW1lcyA9IHtcbiAgcmVwZWF0OiBbJ2NoaWxkX2QnLCAnY2hpbGRfZScsICdjaGlsZF9mJ10sXG4gIGZhY2V0OiBbJ2NoaWxkXzAnLCAnY2hpbGRfMScsICdjaGlsZF8yJ11cbn07XG5cbmV4cG9ydCBjb25zdCBoaXRzID0ge1xuICBkaXNjcmV0ZToge1xuICAgIHFxOiBbOCwgMTldLFxuICAgIHFxX2NsZWFyOiBbNSwgMTZdLFxuXG4gICAgYmluczogWzQsIDI5XSxcbiAgICBiaW5zX2NsZWFyOiBbMTgsIDddLFxuXG4gICAgcmVwZWF0OiBbNSwgMTAsIDE3XSxcbiAgICByZXBlYXRfY2xlYXI6IFsxMywgMTQsIDJdLFxuXG4gICAgZmFjZXQ6IFsyLCA2LCA5XSxcbiAgICBmYWNldF9jbGVhcjogWzMsIDQsIDhdXG4gIH0sXG5cbiAgaW50ZXJ2YWw6IHtcbiAgICBkcmFnOiBbWzUsIDE0XSwgWzE4LCAyNl1dLFxuICAgIGRyYWdfY2xlYXI6IFtbNV0sIFsxNl1dLFxuICAgIHRyYW5zbGF0ZTogW1s2LCAxNl0sIFsyNCwgOF1dLFxuXG4gICAgYmluczogW1s0LCA4XSwgWzIsIDddXSxcbiAgICBiaW5zX2NsZWFyOiBbWzVdLCBbOV1dLFxuICAgIGJpbnNfdHJhbnNsYXRlOiBbWzUsIDddLCBbMSwgOF1dLFxuXG4gICAgcmVwZWF0OiBbWzgsIDI5XSwgWzExLCAyNl0sIFs3LCAyMV1dLFxuICAgIHJlcGVhdF9jbGVhcjogW1s4XSwgWzExXSwgWzE3XV0sXG5cbiAgICBmYWNldDogW1sxLCA5XSwgWzIsIDhdLCBbNCwgMTBdXSxcbiAgICBmYWNldF9jbGVhcjogW1szXSwgWzVdLCBbN11dXG4gIH1cbn07XG5cbmZ1bmN0aW9uIGJhc2UoaXRlcjogbnVtYmVyLCBzZWw6IGFueSwgb3B0czogYW55ID0ge30pOiBVbml0U3BlYyB8IExheWVyU3BlYyB7XG4gIGNvbnN0IGRhdGEgPSB7dmFsdWVzOiBvcHRzLnZhbHVlcyB8fCB0dXBsZXN9O1xuICBjb25zdCB4ID0ge2ZpZWxkOiAnYScsIHR5cGU6ICdxdWFudGl0YXRpdmUnLCAuLi5vcHRzLnh9O1xuICBjb25zdCB5ID0ge2ZpZWxkOiAnYicsdHlwZTogJ3F1YW50aXRhdGl2ZScsIC4uLm9wdHMueX07XG4gIGNvbnN0IGNvbG9yID0ge2ZpZWxkOiAnYycsIHR5cGU6ICdub21pbmFsJywgLi4ub3B0cy5jb2xvcn07XG4gIGNvbnN0IHNpemUgPSB7dmFsdWU6IDEwMCwgLi4ub3B0cy5zaXplfTtcbiAgY29uc3Qgc2VsZWN0aW9uID0ge3NlbH07XG4gIGNvbnN0IG1hcmsgPSAnY2lyY2xlJztcblxuICByZXR1cm4gaXRlciAlIDIgPT09IDAgPyB7XG4gICAgZGF0YSwgc2VsZWN0aW9uLCBtYXJrLFxuICAgIGVuY29kaW5nOiB7XG4gICAgICB4LCB5LCBzaXplLFxuICAgICAgY29sb3I6IHtcbiAgICAgICAgY29uZGl0aW9uOiB7c2VsZWN0aW9uOiAnc2VsJywgLi4uY29sb3J9LFxuICAgICAgICB2YWx1ZTogJ2dyZXknXG4gICAgICB9XG4gICAgfVxuICB9IDoge1xuICAgIGRhdGEsXG4gICAgbGF5ZXI6IFt7XG4gICAgICBzZWxlY3Rpb24sIG1hcmssXG4gICAgICBlbmNvZGluZzoge1xuICAgICAgICB4LCB5LCBzaXplLCBjb2xvcixcbiAgICAgICAgb3BhY2l0eToge3ZhbHVlOiAwLjI1fVxuICAgICAgfVxuICAgIH0sIHtcbiAgICAgIHRyYW5zZm9ybTogW3tmaWx0ZXI6IHtzZWxlY3Rpb246ICdzZWwnfX1dLFxuICAgICAgbWFyayxcbiAgICAgIGVuY29kaW5nOiB7eCwgeSwgc2l6ZSwgY29sb3J9XG4gICAgfV1cbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNwZWMoY29tcG9zZTogQ29tcG9zZVR5cGUsIGl0ZXI6IG51bWJlciwgc2VsOiBhbnksIG9wdHM6IGFueSA9IHt9KTogVG9wTGV2ZWxFeHRlbmRlZFNwZWMge1xuICBjb25zdCB7ZGF0YSwgLi4uc3BlY30gPSBiYXNlKGl0ZXIsIHNlbCwgb3B0cyk7XG4gIGNvbnN0IHJlc29sdmUgPSBvcHRzLnJlc29sdmU7XG4gIHN3aXRjaCAoY29tcG9zZSkge1xuICAgIGNhc2UgJ3VuaXQnOlxuICAgICAgcmV0dXJuIHtkYXRhLCAuLi5zcGVjfTtcbiAgICBjYXNlICdmYWNldCc6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkYXRhLFxuICAgICAgICBmYWNldDoge3Jvdzoge2ZpZWxkOiAnYycsIHR5cGU6ICdub21pbmFsJ319LFxuICAgICAgICBzcGVjLFxuICAgICAgICByZXNvbHZlXG4gICAgICB9O1xuICAgIGNhc2UgJ3JlcGVhdCc6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkYXRhLFxuICAgICAgICByZXBlYXQ6IHtyb3c6IFsnZCcsICdlJywgJ2YnXX0sXG4gICAgICAgIHNwZWMsXG4gICAgICAgIHJlc29sdmVcbiAgICAgIH07XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVuaXROYW1lUmVnZXgoc3BlY1R5cGU6IENvbXBvc2VUeXBlLCBpZHg6IG51bWJlcikge1xuICBjb25zdCBuYW1lID0gdW5pdE5hbWVzW3NwZWNUeXBlXVtpZHhdLnJlcGxhY2UoJ2NoaWxkXycsICcnKTtcbiAgcmV0dXJuIG5ldyBSZWdFeHAoYGNoaWxkKC4qPylfJHtuYW1lfWApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyZW50U2VsZWN0b3IoY29tcG9zaXRlVHlwZTogQ29tcG9zZVR5cGUsIGluZGV4OiBudW1iZXIpIHtcbiAgcmV0dXJuIGNvbXBvc2l0ZVR5cGUgPT09ICdmYWNldCcgPyBgY2VsbCA+IGc6bnRoLWNoaWxkKCR7aW5kZXggKyAxfSlgIDpcbiAgICAgdW5pdE5hbWVzLnJlcGVhdFtpbmRleF0gKyAnX2dyb3VwJztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGJydXNoKGtleTogc3RyaW5nLCBpZHg6IG51bWJlciwgcGFyZW50Pzogc3RyaW5nLCB0YXJnZXRCcnVzaD86IGJvb2xlYW4pIHtcbiAgY29uc3QgZm4gPSBrZXkubWF0Y2goJ19jbGVhcicpID8gJ2NsZWFyJyA6ICdicnVzaCc7XG4gIHJldHVybiBgcmV0dXJuICR7Zm59KCR7aGl0cy5pbnRlcnZhbFtrZXldW2lkeF0uam9pbignLCAnKX0sICR7c3RyaW5nVmFsdWUocGFyZW50KX0sICR7ISF0YXJnZXRCcnVzaH0pYDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHB0KGtleTogc3RyaW5nLCBpZHg6IG51bWJlciwgcGFyZW50Pzogc3RyaW5nKSB7XG4gIGNvbnN0IGZuID0ga2V5Lm1hdGNoKCdfY2xlYXInKSA/ICdjbGVhcicgOiAncHQnO1xuICByZXR1cm4gYHJldHVybiAke2ZufSgke2hpdHMuZGlzY3JldGVba2V5XVtpZHhdfSwgJHtzdHJpbmdWYWx1ZShwYXJlbnQpfSlgO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZW1iZWRGbihicm93c2VyOiBXZWJkcml2ZXJJTy5DbGllbnQ8dm9pZD4pIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKHNwZWM6IFRvcExldmVsRXh0ZW5kZWRTcGVjKSB7XG4gICAgYnJvd3Nlci5leGVjdXRlKChfKSA9PiB3aW5kb3dbJ2VtYmVkJ10oXyksIHNwZWMpO1xuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc3ZnKGJyb3dzZXI6IFdlYmRyaXZlcklPLkNsaWVudDx2b2lkPiwgcGF0aDogc3RyaW5nLCBmaWxlbmFtZTogc3RyaW5nKSB7XG4gIGNvbnN0IHhtbCA9IGJyb3dzZXIuZXhlY3V0ZUFzeW5jKChkb25lKSA9PiB7XG4gICAgd2luZG93Wyd2aWV3J10ucnVuQWZ0ZXIoKHZpZXc6IGFueSkgPT4gdmlldy50b1NWRygpLnRoZW4oKF86IHN0cmluZykgPT4gZG9uZShfKSkpO1xuICB9KTtcblxuICBpZiAoZ2VuZXJhdGUpIHtcbiAgICBta2RpcnAocGF0aCA9IGAke291dHB1dH0vJHtwYXRofWApO1xuICAgIGZzLndyaXRlRmlsZVN5bmMoYCR7cGF0aH0vJHtmaWxlbmFtZX0uc3ZnYCwgeG1sLnZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiB4bWwudmFsdWU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0ZXN0UmVuZGVyRm4oYnJvd3NlcjogV2ViZHJpdmVySU8uQ2xpZW50PHZvaWQ+LCBwYXRoOiBzdHJpbmcpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKGZpbGVuYW1lOiBzdHJpbmcpIHtcbiAgICAvLyBjb25zdCByZW5kZXIgPVxuICAgICAgc3ZnKGJyb3dzZXIsIHBhdGgsIGZpbGVuYW1lKTtcbiAgICAvLyBjb25zdCBmaWxlID0gZnMucmVhZEZpbGVTeW5jKGAke291dHB1dH0vJHtwYXRofS8ke2ZpbGVuYW1lfS5zdmdgKTtcbiAgICAvLyBhc3NlcnQuZXF1YWwocmVuZGVyLCBmaWxlKTtcbiAgfTtcbn1cbiJdfQ==